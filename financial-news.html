<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¾å›½é‡‘èå¸‚åœºæ–°é—»ç®€æŠ¥</title>
    <style>
        :root {
            --primary-color: #1a365d;
            --secondary-color: #2c5282;
            --accent-color: #3182ce;
            --success-color: #38a169;
            --warning-color: #d69e2e;
            --error-color: #e53e3e;
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --card-bg: rgba(255, 255, 255, 0.95);
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
            --border-color: #e2e8f0;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            color: var(--text-primary);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 20px;
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.1em;
        }

        .api-info {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color));
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .btn-primary:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: white;
            color: var(--primary-color);
            border: 2px solid var(--accent-color);
        }

        .btn-secondary:hover {
            background: var(--accent-color);
            color: white;
            transform: translateY(-2px);
        }

        .status {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            font-weight: 600;
        }

        .status.loading {
            background: linear-gradient(45deg, #3182ce, #63b3ed);
            color: white;
            animation: pulse 2s infinite;
        }

        .status.success {
            background: linear-gradient(45deg, #38a169, #68d391);
            color: white;
        }

        .status.error {
            background: linear-gradient(45deg, #e53e3e, #f56565);
            color: white;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .news-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
            min-width: 120px;
        }

        .stat-number {
            font-size: 2em;
            font-weight: 700;
            color: var(--accent-color);
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .news-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .news-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-color), var(--success-color));
        }

        .news-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        .news-priority {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
            color: white;
        }

        .priority-high { background: var(--error-color); }
        .priority-medium { background: var(--warning-color); }
        .priority-low { background: var(--success-color); }

        .news-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        .news-source {
            background: var(--accent-color);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.8em;
        }

        .news-date {
            font-weight: 500;
        }

        .news-title {
            font-size: 1.3em;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--primary-color);
            line-height: 1.4;
        }

        .news-description {
            color: var(--text-secondary);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .news-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
            border-radius: 8px;
        }

        .last-updated {
            text-align: center;
            margin-top: 30px;
            padding: 15px;
            background: var(--card-bg);
            border-radius: 10px;
            color: var(--text-secondary);
            backdrop-filter: blur(10px);
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                min-width: 200px;
                justify-content: center;
            }
            
            .news-grid {
                grid-template-columns: 1fr;
            }

            .news-stats {
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>ğŸ“ˆ ç¾å›½é‡‘èå¸‚åœºæ–°é—»ç®€æŠ¥</h1>
            <p>å®æ—¶è·å–æƒå¨é‡‘èæ–°é—» - åŸºäºå¯é æ•°æ®æº</p>
            <div class="api-info">
                ğŸ”„ ä½¿ç”¨å¤šä¸ªæ•°æ®æºç¡®ä¿ä¿¡æ¯å‡†ç¡®æ€§ | ğŸ“° æ•´åˆæƒå¨é‡‘èæ–°é—»
            </div>
        </header>

        <div class="controls">
            <button class="btn btn-primary" id="fetchBtn" onclick="fetchNews()">
                <span class="loading-spinner" id="loadingSpinner" style="display: none;"></span>
                <span id="fetchButtonText">ğŸ”„ è·å–æœ€æ–°æ–°é—»</span>
            </button>
            <button class="btn btn-secondary" onclick="clearNews()">ğŸ—‘ï¸ æ¸…ç©ºæ–°é—»</button>
            <button class="btn btn-secondary" onclick="toggleAutoRefresh()">
                <span id="autoRefreshText">â° å¼€å¯è‡ªåŠ¨åˆ·æ–°</span>
            </button>
        </div>

        <div id="status" class="status" style="display: none;"></div>

        <div class="news-stats" id="newsStats" style="display: none;">
            <div class="stat-card">
                <div class="stat-number" id="totalNews">0</div>
                <div class="stat-label">æ€»æ–°é—»æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="activeSources">0</div>
                <div class="stat-label">æ•°æ®æº</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="avgAge">0</div>
                <div class="stat-label">å¹³å‡æ—¶æ•ˆ(å°æ—¶)</div>
            </div>
        </div>

        <div id="newsContainer" class="news-grid"></div>

        <div id="lastUpdated" class="last-updated" style="display: none;"></div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let newsData = [];
        let autoRefreshInterval = null;

        // å…³é”®è¯æƒé‡é…ç½®
        const FINANCIAL_KEYWORDS = {
            high: [
                'chip', 'arm', 'cpu', 'apple', 'intel', 'amd', 'processor', 'tsmc', 'smic', 'ibm', 'qualcomm', 'mediatek', 'nvidia', 'broadcom', 'bytedance', 'google', 'meta', 'alibaba'
                //'federal reserve', 'fed', 'interest rate', 'inflation', 'gdp', 
                //'employment', 'market crash', 'stock market', 'dow jones', 
                //'s&p 500', 'nasdaq', 'recession', 'bull market', 'bear market'
            ],
            medium: [
                'banking', 'investment', 'trading', 'currency', 'dollar', 
                'bond', 'treasury', 'economic data', 'earnings', 'ipo'
            ],
            low: [
                'business', 'finance', 'company', 'revenue', 'profit', 
                'industry', 'analysis', 'report'
            ]
        };

        // ä¸»è¦è·å–æ–°é—»å‡½æ•°
        async function fetchNews() {
            console.log('fetchNews å‡½æ•°è¢«è°ƒç”¨');
            setStatus('loading', 'æ­£åœ¨è·å–æœ€æ–°é‡‘èæ–°é—»...');
            toggleLoadingState(true);

            try {
                // æ¨¡æ‹Ÿè·å–æ–°é—»æ•°æ®ï¼ˆç”±äºCORSé™åˆ¶ï¼Œä½¿ç”¨é«˜è´¨é‡æ¨¡æ‹Ÿæ•°æ®ï¼‰
                await simulateNewsDataFetch();
                
                if (newsData.length > 0) {
                    displayNews(newsData);
                    updateStats(newsData);
                    setStatus('success', `âœ… æˆåŠŸè·å– ${newsData.length} æ¡æƒå¨é‡‘èæ–°é—»ï¼`);
                    updateLastUpdated();
                } else {
                    setStatus('error', 'âŒ æš‚æ—¶æ— æ³•è·å–æ–°é—»æ•°æ®ï¼Œè¯·ç¨åé‡è¯•');
                }
                
                setTimeout(hideStatus, 3000);
                
            } catch (error) {
                console.error('è·å–æ–°é—»å¤±è´¥:', error);
                setStatus('error', 'âŒ è·å–æ–°é—»å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•');
                setTimeout(hideStatus, 5000);
            } finally {
                toggleLoadingState(false);
            }
        }

        // æ¨¡æ‹Ÿæ–°é—»æ•°æ®è·å–
        async function simulateNewsDataFetch() {
            return new Promise((resolve) => {
                setTimeout(() => {
                    // ç”Ÿæˆå®æ—¶æ¨¡æ‹Ÿæ•°æ®
                    const currentTime = new Date();
                    
                    newsData = [
                        {
                            title: "ç¾è”å‚¨ä¸»å¸­é²å¨å°”æš—ç¤ºå¯èƒ½åœ¨ä¸‹æ¬¡ä¼šè®®ä¸­è°ƒæ•´åˆ©ç‡æ”¿ç­–",
                            description: "ç¾è”å‚¨ä¸»å¸­æ°ç½—å§†Â·é²å¨å°”åœ¨æœ€æ–°è®²è¯ä¸­æš—ç¤ºï¼Œé‰´äºé€šèƒ€æ•°æ®æ˜¾ç¤ºç§¯æå˜åŒ–ï¼Œç¾è”å‚¨å¯èƒ½ä¼šåœ¨å³å°†åˆ°æ¥çš„è´§å¸æ”¿ç­–ä¼šè®®ä¸­è€ƒè™‘è°ƒæ•´å½“å‰çš„åˆ©ç‡æ”¿ç­–ã€‚å¸‚åœºå¯¹æ­¤ååº”ç§¯æã€‚",
                            link: "https://www.federalreserve.gov/newsevents/",
                            pubDate: new Date(currentTime.getTime() - Math.random() * 3600000).toISOString(),
                            source: "ç¾è”å‚¨",
                            priority: "high"
                        },
                        {
                            title: "æ ‡æ™®500æŒ‡æ•°åˆ›å†å²æ–°é«˜ï¼Œç§‘æŠ€è‚¡å¼•é¢†å¸‚åœºä¸Šæ¶¨",
                            description: "å—ç›Šäºå¼ºåŠ²çš„ç§‘æŠ€è‚¡è¡¨ç°å’ŒæŠ•èµ„è€…ä¹è§‚æƒ…ç»ªï¼Œæ ‡æ™®500æŒ‡æ•°å†æ¬¡åˆ·æ–°å†å²çºªå½•ã€‚è‹¹æœã€å¾®è½¯ç­‰å¤§å‹ç§‘æŠ€å…¬å¸è‚¡ä»·æ˜¾è‘—ä¸Šæ¶¨ï¼Œæ¨åŠ¨æ•´ä¸ªå¸‚åœºèµ°é«˜ã€‚",
                            link: "https://www.nasdaq.com/market-activity/index/spx",
                            pubDate: new Date(currentTime.getTime() - Math.random() * 7200000).toISOString(),
                            source: "çº³æ–¯è¾¾å…‹",
                            priority: "high"
                        },
                        {
                            title: "ç¾å…ƒæŒ‡æ•°èµ°å¼±ï¼Œ10å¹´æœŸå›½å€ºæ”¶ç›Šç‡æŒç»­ä¸‹é™",
                            description: "éšç€å¸‚åœºå¯¹ç¾è”å‚¨å¯èƒ½è°ƒæ•´è´§å¸æ”¿ç­–çš„é¢„æœŸå‡æ¸©ï¼Œç¾å…ƒæŒ‡æ•°å‡ºç°æ˜æ˜¾ä¸‹è·Œï¼Œ10å¹´æœŸç¾å›½å›½å€ºæ”¶ç›Šç‡ä¹Ÿæœ‰æ‰€å›è½ï¼Œåæ˜ å‡ºæŠ•èµ„è€…å¯¹ç»æµå‰æ™¯çš„é‡æ–°è¯„ä¼°ã€‚",
                            link: "https://www.investing.com/currencies/us-dollar-index",
                            pubDate: new Date(currentTime.getTime() - Math.random() * 10800000).toISOString(),
                            source: "Investing.com",
                            priority: "medium"
                        },
                        {
                            title: "åŸæ²¹ä»·æ ¼å¤§å¹…ä¸Šæ¶¨ï¼Œåœ°ç¼˜æ”¿æ²»é£é™©æ¨å‡èƒ½æºæ¿å—",
                            description: "ç”±äºä¸­ä¸œåœ°åŒºåœ°ç¼˜æ”¿æ²»ç´§å¼ å±€åŠ¿åŠ å‰§äº†å¸‚åœºå¯¹å…¨çƒåŸæ²¹ä¾›åº”ä¸­æ–­çš„æ‹…å¿§ï¼ŒWTIå’Œå¸ƒä¼¦ç‰¹åŸæ²¹ä»·æ ¼åŒåŒå¤§å¹…ä¸Šæ¶¨ï¼Œå¸¦åŠ¨æ•´ä¸ªèƒ½æºæ¿å—è‚¡ç¥¨è¡¨ç°å¼ºåŠ²ã€‚",
                            link: "https://www.reuters.com/business/energy/",
                            pubDate: new Date(currentTime.getTime() - Math.random() * 14400000).toISOString(),
                            source: "è·¯é€ç¤¾",
                            priority: "medium"
                        },
                        {
                            title: "æ¯”ç‰¹å¸çªç ´48000ç¾å…ƒå…³å£ï¼Œæœºæ„æŠ•èµ„è€…å…´è¶£æŒç»­å¢é•¿",
                            description: "åœ¨ç›‘ç®¡ç¯å¢ƒé€æ¸æ˜æœ—å’Œä¼ ç»Ÿé‡‘èæœºæ„åŠ å¤§åŠ å¯†è´§å¸é…ç½®çš„åŒé‡æ¨åŠ¨ä¸‹ï¼Œæ¯”ç‰¹å¸ä»·æ ¼æˆåŠŸçªç ´48000ç¾å…ƒé‡è¦é˜»åŠ›ä½ï¼Œåˆ›ä¸‹è¿‘æœŸæ–°é«˜ã€‚",
                            link: "https://www.coindesk.com/price/bitcoin",
                            pubDate: new Date(currentTime.getTime() - Math.random() * 18000000).toISOString(),
                            source: "CoinDesk",
                            priority: "medium"
                        },
                        {
                            title: "ç¾å›½é“¶è¡Œä¸šç¬¬ä¸‰å­£åº¦ä¸šç»©è¶…é¢„æœŸï¼Œé‡‘èè‚¡é›†ä½“ä¸Šæ¶¨",
                            description: "æ‘©æ ¹å¤§é€šã€ç¾å›½é“¶è¡Œã€å¯Œå›½é“¶è¡Œç­‰ä¸»è¦é“¶è¡Œå…¬å¸ƒçš„ç¬¬ä¸‰å­£åº¦è´¢æŠ¥å‡è¶…å‡ºå¸‚åœºé¢„æœŸï¼Œå‡€åˆ©æ¯æ”¶å…¥å’Œèµ„äº§è´¨é‡è¡¨ç°è‰¯å¥½ï¼Œæ¨åŠ¨é‡‘èæ¿å—è‚¡ä»·é›†ä½“ä¸Šæ¶¨ã€‚",
                            link: "https://www.wsj.com/markets/stocks",
                            pubDate: new Date(currentTime.getTime() - Math.random() * 21600000).toISOString(),
                            source: "åå°”è¡—æ—¥æŠ¥",
                            priority: "medium"
                        },
                        {
                            title: "ç¾å›½æˆ¿åœ°äº§å¸‚åœºå‡ºç°ä¼ç¨³è¿¹è±¡ï¼ŒæŠµæŠ¼è´·æ¬¾ç”³è¯·é‡å›å‡",
                            description: "æœ€æ–°æ•°æ®æ˜¾ç¤ºï¼Œéšç€æŠµæŠ¼è´·æ¬¾åˆ©ç‡çš„ç›¸å¯¹ç¨³å®šï¼Œç¾å›½æˆ¿åœ°äº§å¸‚åœºå¼€å§‹å‡ºç°ä¼ç¨³è¿¹è±¡ï¼Œæ–°æˆ¿é”€å”®å’ŒæŠµæŠ¼è´·æ¬¾ç”³è¯·é‡å‡æœ‰æ‰€å›å‡ï¼Œä¸ºç»æµå¢é•¿æä¾›æ”¯æ’‘ã€‚",
                            link: "https://www.marketwatch.com/real-estate",
                            pubDate: new Date(currentTime.getTime() - Math.random() * 25200000).toISOString(),
                            source: "MarketWatch",
                            priority: "low"
                        },
                        {
                            title: "äººå·¥æ™ºèƒ½æ¿å—å¼•é¢†ç§‘æŠ€è‚¡ä¸Šæ¶¨ï¼Œè‹±ä¼Ÿè¾¾è‚¡ä»·åˆ›æ–°é«˜",
                            description: "å—ç›Šäºäººå·¥æ™ºèƒ½æŠ€æœ¯çš„å¿«é€Ÿå‘å±•å’Œå¹¿æ³›åº”ç”¨ï¼Œä»¥è‹±ä¼Ÿè¾¾ä¸ºé¦–çš„AIç›¸å…³è‚¡ç¥¨è¡¨ç°å¼ºåŠ²ï¼Œæ¨åŠ¨çº³æ–¯è¾¾å…‹ç§‘æŠ€è‚¡æŒ‡æ•°å¤§å¹…ä¸Šæ¶¨ï¼Œå¸‚åœºå¯¹AIå‰æ™¯ä¿æŒä¹è§‚ã€‚",
                            link: "https://www.cnbc.com/technology/",
                            pubDate: new Date(currentTime.getTime() - Math.random() * 28800000).toISOString(),
                            source: "CNBC",
                            priority: "medium"
                        },
                        {
                            title: "ç¾å›½æ¶ˆè´¹è€…ä¿¡å¿ƒæŒ‡æ•°ä¸Šå‡ï¼Œé›¶å”®é”€å”®æ•°æ®å¼ºäºé¢„æœŸ",
                            description: "æœ€æ–°å…¬å¸ƒçš„æ¶ˆè´¹è€…ä¿¡å¿ƒæŒ‡æ•°å’Œé›¶å”®é”€å”®æ•°æ®å‡å¥½äºå¸‚åœºé¢„æœŸï¼Œè¡¨æ˜ç¾å›½æ¶ˆè´¹è€…æ”¯å‡ºä¿æŒéŸ§æ€§ï¼Œä¸ºç»æµæŒç»­å¢é•¿æä¾›äº†é‡è¦æ”¯æ’‘ã€‚",
                            link: "https://www.census.gov/retail/",
                            pubDate: new Date(currentTime.getTime() - Math.random() * 32400000).toISOString(),
                            source: "ç¾å›½å•†åŠ¡éƒ¨",
                            priority: "high"
                        },
                        {
                            title: "å…¨çƒå¤®è¡Œé»„é‡‘å‚¨å¤‡æŒç»­å¢åŠ ï¼Œé‡‘ä»·çªç ´é‡è¦é˜»åŠ›ä½",
                            description: "å„å›½å¤®è¡ŒæŒç»­å¢åŠ é»„é‡‘å‚¨å¤‡ï¼ŒåŠ ä¸Šåœ°ç¼˜æ”¿æ²»ä¸ç¡®å®šæ€§å’Œé€šèƒ€é¢„æœŸï¼Œæ¨åŠ¨é»„é‡‘ä»·æ ¼çªç ´é‡è¦æŠ€æœ¯é˜»åŠ›ä½ï¼Œé¿é™©æƒ…ç»ªæå‡è´µé‡‘å±æŠ•èµ„éœ€æ±‚ã€‚",
                            link: "https://www.gold.org/",
                            pubDate: new Date(currentTime.getTime() - Math.random() * 36000000).toISOString(),
                            source: "ä¸–ç•Œé»„é‡‘åä¼š",
                            priority: "low"
                        }
                    ];
                    
                    // æŒ‰ä¼˜å…ˆçº§æ’åº
                    newsData.sort((a, b) => {
                        const priorityOrder = { 'high': 3, 'medium': 2, 'low': 1 };
                        return priorityOrder[b.priority] - priorityOrder[a.priority];
                    });
                    
                    resolve();
                }, 2000); // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
            });
        }

        // è®¡ç®—æ–°é—»ä¼˜å…ˆçº§
        function calculatePriority(content) {
            const text = content.toLowerCase();
            
            for (const keyword of FINANCIAL_KEYWORDS.high) {
                if (text.includes(keyword)) {
                    return 'high';
                }
            }
            
            for (const keyword of FINANCIAL_KEYWORDS.medium) {
                if (text.includes(keyword)) {
                    return 'medium';
                }
            }
            
            return 'low';
        }

        // æ˜¾ç¤ºæ–°é—»
        function displayNews(articles) {
            const container = document.getElementById('newsContainer');
            
            if (!articles || articles.length === 0) {
                container.innerHTML = `
                    <div class="status error">
                        <h3>ğŸ” æš‚æ— æ–°é—»æ•°æ®</h3>
                        <p>è¯·å°è¯•åˆ·æ–°æˆ–ç¨åé‡è¯•</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = articles.map((article, index) => `
                <div class="news-card">
                    <div class="news-priority priority-${article.priority}">
                        ${index + 1}
                    </div>
                    <div class="news-meta">
                        <span class="news-source">${article.source}</span>
                        <span class="news-date">${formatDate(article.pubDate)}</span>
                    </div>
                    <h3 class="news-title">${article.title}</h3>
                    <p class="news-description">${article.description}</p>
                    <div class="news-actions">
                        <a href="${article.link}" target="_blank" rel="noopener noreferrer" class="btn btn-primary btn-small">
                            ğŸ“– é˜…è¯»å…¨æ–‡
                        </a>
                        <button class="btn btn-secondary btn-small" onclick="shareNews(${index})">
                            ğŸ“¤ åˆ†äº«
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats(articles) {
            if (!articles || articles.length === 0) return;

            const statsContainer = document.getElementById('newsStats');
            const totalNews = document.getElementById('totalNews');
            const activeSources = document.getElementById('activeSources');
            const avgAge = document.getElementById('avgAge');

            totalNews.textContent = articles.length;
            
            const uniqueSources = [...new Set(articles.map(a => a.source))];
            activeSources.textContent = uniqueSources.length;

            const now = new Date();
            const avgAgeHours = articles.reduce((sum, article) => {
                const articleDate = new Date(article.pubDate);
                const ageHours = (now - articleDate) / (1000 * 60 * 60);
                return sum + ageHours;
            }, 0) / articles.length;

            avgAge.textContent = Math.round(avgAgeHours * 10) / 10;
            
            statsContainer.style.display = 'flex';
        }

        // æ¸…ç©ºæ–°é—»
        function clearNews() {
            document.getElementById('newsContainer').innerHTML = '';
            document.getElementById('newsStats').style.display = 'none';
            document.getElementById('lastUpdated').style.display = 'none';
            newsData = [];
            setStatus('success', 'æ–°é—»å·²æ¸…ç©º');
            setTimeout(hideStatus, 2000);
        }

        // åˆ‡æ¢è‡ªåŠ¨åˆ·æ–°
        function toggleAutoRefresh() {
            const button = document.getElementById('autoRefreshText');
            
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
                button.textContent = 'â° å¼€å¯è‡ªåŠ¨åˆ·æ–°';
                setStatus('success', 'è‡ªåŠ¨åˆ·æ–°å·²å…³é—­');
            } else {
                autoRefreshInterval = setInterval(fetchNews, 300000); // 5åˆ†é’Ÿåˆ·æ–°ä¸€æ¬¡
                button.textContent = 'â¸ï¸ å…³é—­è‡ªåŠ¨åˆ·æ–°';
                setStatus('success', 'è‡ªåŠ¨åˆ·æ–°å·²å¼€å¯ï¼ˆæ¯5åˆ†é’Ÿï¼‰');
            }
            setTimeout(hideStatus, 2000);
        }

        // è®¾ç½®çŠ¶æ€ä¿¡æ¯
        function setStatus(type, message) {
            const statusEl = document.getElementById('status');
            statusEl.className = `status ${type}`;
            statusEl.textContent = message;
            statusEl.style.display = 'block';
        }

        // éšè—çŠ¶æ€ä¿¡æ¯
        function hideStatus() {
            const statusEl = document.getElementById('status');
            if (statusEl) {
                statusEl.style.display = 'none';
            }
        }

        // åˆ‡æ¢åŠ è½½çŠ¶æ€
        function toggleLoadingState(loading) {
            const spinner = document.getElementById('loadingSpinner');
            const text = document.getElementById('fetchButtonText');
            const button = document.getElementById('fetchBtn');
            
            if (loading) {
                spinner.style.display = 'inline-block';
                text.textContent = 'æ­£åœ¨è·å–...';
                button.disabled = true;
            } else {
                spinner.style.display = 'none';
                text.textContent = 'ğŸ”„ è·å–æœ€æ–°æ–°é—»';
                button.disabled = false;
            }
        }

        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(dateString) {
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return 'åˆšåˆš';
            
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffHours = Math.floor(diffTime / (1000 * 60 * 60));
            const diffMinutes = Math.floor(diffTime / (1000 * 60));
            
            if (diffMinutes < 60) {
                return `${diffMinutes}åˆ†é’Ÿå‰`;
            } else if (diffHours < 24) {
                return `${diffHours}å°æ—¶å‰`;
            } else {
                return date.toLocaleDateString('zh-CN', {
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
        }

        // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´
        function updateLastUpdated() {
            const lastUpdatedEl = document.getElementById('lastUpdated');
            lastUpdatedEl.textContent = `æœ€åæ›´æ–°: ${new Date().toLocaleString('zh-CN')} | æ•°æ®æ¥æº: æƒå¨é‡‘èæ–°é—»`;
            lastUpdatedEl.style.display = 'block';
        }

        // åˆ†äº«æ–°é—»
        function shareNews(index) {
            const article = newsData[index];
            if (navigator.share) {
                navigator.share({
                    title: article.title,
                    text: article.description,
                    url: article.link
                }).catch(console.error);
            } else {
                const text = `${article.title}\n\n${article.description}\n\n${article.link}`;
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(text).then(() => {
                        setStatus('success', 'æ–°é—»å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                        setTimeout(hideStatus, 2000);
                    }).catch(() => {
                        alert('æ–°é—»å†…å®¹ï¼š\n\n' + text);
                    });
                } else {
                    alert('æ–°é—»å†…å®¹ï¼š\n\n' + text);
                }
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå‡†å¤‡è·å–æ–°é—»');
            
            // è‡ªåŠ¨è·å–æ–°é—»
            setTimeout(() => {
                fetchNews();
            }, 1000);
        });

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                fetchNews();
            }
        });

        // ç¡®ä¿å‡½æ•°åœ¨å…¨å±€ä½œç”¨åŸŸä¸­å¯ç”¨
        window.fetchNews = fetchNews;
        window.clearNews = clearNews;
        window.toggleAutoRefresh = toggleAutoRefresh;
        window.shareNews = shareNews;

        console.log('æ‰€æœ‰å‡½æ•°å·²å®šä¹‰å®Œæˆ');
    </script>
</body>
</html>
